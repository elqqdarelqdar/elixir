<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Voice Elixir</title>
    <style>
        body { 
            background: #000; color: #0f0; font-family: sans-serif; 
            margin: 0; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; height: 100vh; 
        }
        #elixir { font-size: 10rem; font-weight: bold; }
        #status { font-size: 1.2rem; color: #555; }
        #timer { font-size: 1.5rem; color: #aaa; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div id="timer">00:00 (x1)</div>
    <div id="elixir">5.0</div>
    <div id="status">Жду голос...</div>

    <script>
        let count = 5.0;
        let rate = 1;
        let seconds = 0;
        const display = document.getElementById('elixir');
        const timerDisplay = document.getElementById('timer');

        // Таймер боя и авто-прирост
        setInterval(() => {
            seconds++;
            if (seconds === 120) rate = 2; // x2 через 2 мин
            if (seconds === 210) rate = 3; // x3 через 3.5 мин
            
            let m = Math.floor(seconds / 60);
            let s = seconds % 60;
            timerDisplay.innerText = `${m}:${s < 10 ? '0'+s : s} (x${rate})`;

            if (count < 10) {
                count += (0.35 * rate) / 10;
                if (count > 10) count = 10;
                updateDisplay();
            }
        }, 100);

        function updateDisplay() {
            display.innerText = count.toFixed(1);
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'ru-RU';
        recognition.continuous = true;
        
        // КЛЮЧЕВОЙ ПАРАМЕТР ДЛЯ СКОРОСТИ:
        recognition.interimResults = true; 

        const numbersMap = {
            'раз':1,'один':1,'два':2,'три':3,'четыре':4,'пять':5,
            'шесть':6,'семь':7,'восемь':8,'девять':9,'десять':10
        };

        recognition.onresult = (event) => {
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                if (event.results[i].isFinal || event.results[i][0].confidence > 0.3) {
                    const text = event.results[i][0].transcript.toLowerCase();
                    document.getElementById('status').innerText = text;

                    for (let word in numbersMap) {
                        if (text.includes(word)) {
                            count -= numbersMap[word];
                            if (count < 0) count = 0;
                            updateDisplay();
                            // Очищаем результат, чтобы не вычесть дважды
                            recognition.stop(); 
                            return;
                        }
                    }
                }
            }
        };

        recognition.onend = () => recognition.start();
        recognition.start();

        // Сброс при тапе
        document.body.onclick = () => {
            count = 5.0; seconds = 0; rate = 1;
            updateDisplay();
        };
    </script>
</body>
</html>
